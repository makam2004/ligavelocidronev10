<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin Tracks</title>
  <link rel="stylesheet" href="/style-ui.css">
</head>
<body>
  <h2>Administrar Tracks</h2>
  <label><input type="checkbox" id="is_official" checked> Track oficial</label>
  <div id="oficial-fields">
    <label>Track ID: <input id="track_id" type="number"></label>
  </div>
  <div id="unoficial-fields" style="display:none">
    <label>Online ID: <input id="online_id" type="text"></label>
  </div>
  <label>Vueltas: <input id="laps" type="number" value="1" min="1" max="3"></label>
  <button onclick="guardarTrack()">Guardar Track</button>

  <script>
    const chk=document.getElementById('is_official');
    const off=document.getElementById('oficial-fields');
    const uno=document.getElementById('unoficial-fields');
    chk.addEventListener('change',()=>{
      off.style.display=chk.checked?'':'none';
      uno.style.display=chk.checked?'none':'';
    });
    async function guardarTrack(){
      const body={
        is_official:chk.checked,
        laps:Number(document.getElementById('laps').value||1),
        active:true
      };
      if(chk.checked) body.track_id=Number(document.getElementById('track_id').value||0);
      else body.online_id=document.getElementById('online_id').value;
      const r=await fetch('/api/tracks/upsert',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
      alert('Track enviado ('+r.status+')');
    }
  </script>
</body>
</html>
